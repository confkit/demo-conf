name: "rust-server"
description: "Rust Server demo"

source:
  git_repo: "git@github.com:confkit/demo-rust.git"
  git_branch: "main"

environment:
  # è‡ªå®šä¹‰ç¯å¢ƒå˜é‡ï¼ˆåŸºäºå†…ç½®å˜é‡ï¼‰
  BUILD_TARGET_DIR: "target/release"

cleaner:
  workspace: false
  artifacts: false

steps:
- name: "å…‹éš†é¡¹ç›®"
  commands:
  - "echo 'ğŸ” å…‹éš†é¡¹ç›®'"
  - "git clone ${GIT_REPO} -b main ${PROJECT_NAME}"

- name: "ä»£ç æ£€æŸ¥"
  container: "rust-builder-1.88"
  working_dir: "${CONTAINER_WORKSPACE_DIR}/${PROJECT_NAME}"
  commands:
  - "cargo fmt --check"
  - "cargo clippy --all-targets --all-features -- -D warnings"

- name: "æ„å»ºåº”ç”¨"
  container: "rust-builder-1.88"
  working_dir: "${CONTAINER_WORKSPACE_DIR}/${PROJECT_NAME}"
  commands:
  - "cargo build --release"

- name: "æ¬è¿æ„å»ºäº§ç‰©"
  container: "rust-builder-1.88"
  working_dir: "${CONTAINER_WORKSPACE_DIR}/${PROJECT_NAME}"
  commands:
  - "cp ${BUILD_TARGET_DIR}/demo-rust ${CONTAINER_ARTIFACTS_DIR}"
